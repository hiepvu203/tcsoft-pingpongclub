@model IEnumerable<tcsoft_pingpongclub.Models.Groupstage>

@{
    ViewData["Title"] = "Danh sách Bảng Đấu";
    var IdTournament = (int)ViewBag.IdTournament;
}

<h1 class="text-center mb-4">Danh sách Bảng Đấu</h1>

<div class="d-flex justify-content-between align-items-center mb-3">
    <!-- Kiểm tra nếu không có bảng đấu -->
    @if (!Model.Any())
    {
        <div>
            <a asp-action="CreateTwoGroups" asp-route-id="@IdTournament" class="btn btn-secondary me-2">Tạo 2 bảng Loại</a>
            <a asp-action="CreateFourGroups" asp-route-id="@IdTournament" class="btn btn-success">Tạo 4 bảng Loại</a>
        </div>
    }
    else
    {
        <div>
            <a asp-action="Create" asp-route-id="@IdTournament" class="btn btn-primary">Tạo bảng đấu mới</a>
        </div>
    }

    <!-- Select nằm bên phải -->
    <div class="ms-auto">
        <select id="IdOrder" class="form-select" aria-label="Lựa chọn vòng đấu">
            <option value="">Tất Cả Vòng Đấu</option>
            <option value="1">Loại</option>
            <option value="2">Tứ kết</option>
            <option value="3">Bán kết</option>
            <option value="4">Chung kết</option>
        </select>
    </div>
</div>

@if (!Model.Any())
{
    <p class="text-center text-danger">Chưa có bảng đấu</p>
}
else
{
    <table class="table table-striped table-bordered table-hover">
        <thead class="thead-dark">
            <tr>
                <th style="width:200px;">Tên Bảng</th>
                <th>Số Lượng Người</th>
                <th>Vòng Đấu</th>
                <th>Giải Đấu</th>
                <th>Trạng Thái</th>
                <th>Hành Động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Where(g => g.Status == true))
            {
                <tr class="groupstage-row" data-idorder="@item.IOrder">
                    <td>@Html.DisplayFor(modelItem => item.NameGroup)</td>
                    <td>@Html.DisplayFor(modelItem => item.Amount)</td>
                    <td>
                        @if (item.IOrder == 1)
                        {
                            @:Loại
                        }
                        else if (item.IOrder == 2)
                        {
                            @:Tứ kết
                        }
                        else if (item.IOrder == 3)
                        {
                            @:Bán kết
                        }
                        else if (item.IOrder == 4)
                        {
                            @:Chung kết
                        }
                    </td>
                    <td>@Html.DisplayFor(modelItem => item.IdTournamentNavigation.TournamentName)</td>
                    <td>
                        @if (item.Status == true)
                        {
                            @:Hiển Thị
                        }
                        else
                        {
                            @:Ẩn
                        }
                    </td>
                    <td>
                        <div class="d-flex flex-column align-items-stretch">
                            <a asp-action="Edit" asp-route-id="@item.IdGroupstage" class="btn btn-warning btn-sm w-100 mb-1">Sửa</a>
                            <a asp-action="Details" asp-route-IdTournament="@IdTournament" asp-route-id="@item.IdGroupstage" class="btn btn-info btn-sm w-100 mb-1">Chi tiết</a>
                            <a asp-action="Delete" asp-route-id="@item.IdGroupstage" class="btn btn-danger btn-sm w-100">Xóa</a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Nút xóa tất cả nằm cuối bảng -->
    <form asp-action="DeleteAll" asp-route-id="@IdTournament" method="post" class="mt-3" id="deleteAllForm">
        <button type="submit" class="btn btn-danger" onclick="return confirmDelete();">Xóa Tất Cả</button>
    </form>
}

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // Hàm xác nhận trước khi xóa tất cả
        function confirmDelete() {
            return confirm("Bạn có chắc chắn muốn xóa tất cả bảng đấu?");
        }

        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("IdOrder").addEventListener("change", function () {
                var selectedValue = this.value; // Lấy giá trị được chọn từ dropdown
                var rows = document.querySelectorAll(".groupstage-row"); // Lấy tất cả các hàng bảng đấu

                rows.forEach(function (row) {
                    var rowIOrder = row.getAttribute("data-idorder"); // Lấy giá trị IOrder của bảng đấu
                    if (selectedValue === "" || rowIOrder === selectedValue) {
                        row.style.display = ""; // Hiển thị bảng đấu nếu giá trị IOrder trùng với giá trị đã chọn
                    } else {
                        row.style.display = "none"; // Ẩn bảng đấu nếu giá trị IOrder không trùng
                    }
                });
            });
        });
    </script>

}
